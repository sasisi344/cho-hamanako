# 301リダイレクト移行ガイド & タスク

WordPressからAstroへの移行において、SEO評価の低下を防ぎ、ユーザーを迷わせないためのリダイレクト設定手順をまとめます。

## 🎯 目的
- 旧サイト（WP）の各記事URLを、新サイト（Astro）の対応する新URLへ301転送する。
- 過去の被リンクや検索エンジンの評価を新URLへ継承させる。

---

## 🛠 旧URLの取得方法（リストアップ術）

旧URLのリストアップには、以下の3つの方法が推奨されます。

### 1. Google Search Console (GSC) から取得する【最推奨】
実際に検索結果に表示されており、ユーザーが訪れている「生きているURL」を確実に取得できます。
1.  GSCの「パフォーマンス」レポートを開く。
2.  「ページ」タブを選択。
3.  期間を長め（過去3〜6ヶ月）に設定。
4.  右上の「エクスポート」からGoogleスプレッドシートやCSVでダウンロードする。

### 2. Google Analytics 4 (GA4) から取得する
アクセス数が多い順にURLを取得できるため、優先順位が付けやすくなります。
1.  GA4の「レポート」＞「エンゲージメント」＞「ページとスクリーン」を開く。
2.  期間を適宜設定。
3.  表の右上の「エクスポート」から共有・ダウンロード。

### 3. XMLサイトマップから取得する【全件網羅・非インデックス対応】
インデックスの有無に関わらず、WP上で「公開」されている全URLを取得する最も確実な方法です。
1. `domain.com/sitemap.xml` を開く（多くのWPでは `sitemap-index.xml` や `post-sitemap.xml` の形式）。
2. 表示される `<loc>` タグ内のURLをすべて抽出する。
3. **メリット**: インデックスされていない書き立ての記事や、無視されがちな古い記事もすべて網羅できます。

### 4. WordPressから直接取得する
公開されている全記事を管理画面側から抽出します。
- **プラグインを使用**: 「Export All URLs」や「WP All Export」などのプラグインを使い、URLとタイトルを抽出する。

---

## 🗺 リダイレクトマップの作成ルール

スプレッドシートに「旧URL」「新URL」を並べて作成します。

1.  **左列（Source）**: 旧URL（ドメイン以降のパス、例: `/category/post-123/`）
2.  **右列（Target）**: 新URL（`category-slug-rules.md` に基づく新パス、例: `/points/omote/location-name/`）
3.  **確認事項**:
    - 日本語URLが含まれる場合は、エンコードされた形式（`%E3%8...`）で記述するのが安全です。
    - トレイリングスラッシュ（末尾の `/`）の有無は、Astro側の設定に合わせます。

---

## ⚙️ Astroでの実装方法

Astro本体のリダイレクト機能を使用します。これにより、デプロイ先がどこであっても適切な処理が行われます。

### `astro.config.mjs` への記述例
```javascript
export default defineConfig({
  redirects: {
    // '/旧パス/': '/新パス',
    '/guide/beginner/car-fishing/': '/guide/beginner/family-car-fishing-points',
    '/category/points/omote-hama/': '/points/omote/omote-hamanako-guide',
  },
});
```

---

## ✅ リダイレクト移行タスク

- [ ] **Step 1: 旧URLリストの抽出**
    - [ ] GSCまたはGA4から、過去1年間の全流入URLを抽出する。
    - [ ] WPの全記事URL（サイトマップ等）を抽出する。
- [ ] **Step 2: リダイレクトマップ（対照表）の作成**
    - [ ] スプレッドシートに旧URLを並べる。
    - [ ] 各URLに対し、`category-slug-rules.md` に基づいた新Slugを決定・入力する。
    - [ ] 「移行先がない記事（統合・削除対象）」があるか確認する。（※トップページや関連度の高い別記事へ飛ばす判断を行う）
- [ ] **Step 3: Astro設定ファイルへの転記**
    - [ ] 作成したマップを `astro.config.mjs` の `redirects` オブジェクトに反映する。
- [ ] **Step 4: プレビュー環境でのテスト**
    - [ ] 旧URLでアクセスした際、意図した新URLに 301（または302）で飛ぶか確認する。
- [ ] **Step 5: 本番反映 & Search Console通知**
    - [ ] ドメインを切り替えた後、新しい `sitemap-index.xml` をGSCに登録する。
