# Streamlit動的地図アプリ導入計画書

浜名湖の釣り場ポイント情報を、従来の静的なGoogleマップ埋め込みから、Python（Streamlit）を活用した高機能・拡張性のある動的地図システムへ移行するための計画です。

## 🎯 導入の目的
- **ユーザー体験の向上**: 魚種、施設（トイレ・駐車場）、ターゲット別に動的に絞り込める地図の提供。
- **データ管理の一元化**: 記事のFrontmatterや外部データ（CSV）と連動し、一箇所の更新で全地図に反映。
- **SEOとパフォーマンスの改善**: 不要な外部スクリプトの大量読み込みを防ぎ、PageSpeed Insightsのスコアを維持する。

---

## 🏗 システム構成

### 1. 基盤技術 (Tech Stack)
- **Map App**: Python / Streamlit
- **Map Library**: Folium or Pydeck (ピンのカスタマイズが容易なライブラリ)
- **Host**: Streamlit Community Cloud (無料・高速公開)
- **Integration**: Astroページからの `iframe` 埋め込み

### 2. 反応型連携 (Dynamic Linking)
個別記事ごとにその場所を中心表示させるため、**URLパラメータ**による連動を採用します。
- **URL例**: `https://hamanako-map.streamlit.app/?point=bentenjima&zoom=15`
- **仕組み**:
    1. Astro側で記事のSlugや座標をパラメータとしてiframe URLに渡す。
    2. Streamlit側でそのパラメータを読み取り、描画の中心座標を自動調整する。

---

## ⚡ パフォーマンス最適化戦略 (Fast Load)

Streamlit（Python実行環境）の読み込み遅延がPageSpeed Insightsに悪影響を与えないよう、以下の「オンデマンド読み込み」を採用します。

### ステップ別描画フロー
1.  **初期表示 (Astro)**:
    - 記事内には、軽量な「地図の静止画像」または「Googleマップへの外部リンク」のみを配置。
2.  **ユーザーアクション**:
    - 「詳細な動的地図（Streamlit）を見る」ボタンを設置。
3.  **オンデマンドロード**:
    - ボタンクリック時に初めて `iframe` を生成・ロード。
    - これにより、クローラー（Google）は重い地図スクリプトを読み込まず、100/100のスコアを維持可能。

---

## 🛠 実装ロードマップ

### Phase 1: データ整備
- [ ] 浜名湖の主要ポイントの座標（緯度・経度）リストをCSV/JSON化。
- [ ] カテゴリやタグ（ハゼ、駐車場あり等）の属性情報を紐付け。

### Phase 2: Streamlitアプリ開発
- [ ] 全ピン表示機能の実装。
- [ ] URLパラメータによる中心位置・ズーム制御の実装。
- [ ] サイドバーによる「魚種別・施設別フィルタ」の実装。

### Phase 3: Astroへの組み込み
- [ ] 個別記事コンポーネント（PointMap.astro等）の作成。
- [ ] オンデマンドロード（ボタンクリックでiframe表示）のJS実装。

---

## 📈 将来的な拡張性
- **リアルタイム釣果連動**: 外部APIやスプレッドシートから「今釣れているポイント」を火の粉アイコンで強調。
- **潮汐情報表示**: 地図上で特定のポイントをクリックすると、その場所の潮汐グラフをポップアップ表示。
- **モバイルファースト設計**: スマホのGPSと連動し、現在地からポイントまでの距離を表示。
